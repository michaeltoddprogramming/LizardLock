{% extends 'accounts/main.html' %}
{% block content %}
<h2>Documents</h2>
{% if error %}
    <div style="color:red;">{{ error }}</div>
{% endif %}

<!-- Upload Form (only if user can create) -->
{% if 'create' in user_permissions.documents %}
<form method="post" enctype="multipart/form-data">
    {% csrf_token %}
    <input type="hidden" name="action" value="create">
    <label for="name">Document Name:</label>
    <input type="text" name="name" id="name" required>
    <input type="file" name="file" accept=".pdf,.doc,.docx,.txt" required>
    <button type="submit">Upload Document</button>
</form>
<hr>
{% endif %}

<ul>
    {% for doc in files %}
        <li>
            <b>{{ doc.name }}</b> ({{ doc.size }} bytes, uploaded {{ doc.uploaded_at|date:"Y-m-d H:i" }})
            <br>by {{ doc.owner }}
            <br>
            
            <!-- Download (only if user can read) -->
            {% if 'read' in user_permissions.documents %}
                <a href="{% url 'serve_document' doc.id %}">
                    <button type="button">Download</button>
                </a>
            {% endif %}
            
            <!-- Delete (only if user has delete permission) -->
            {% if 'delete' in user_permissions.documents %}
            <form method="post" style="display:inline;">
                {% csrf_token %}
                <input type="hidden" name="action" value="delete">
                <input type="hidden" name="id" value="{{ doc.id }}">
                <button type="submit" onclick="return confirm('Delete this document?')">Delete</button>
            </form>
            {% endif %}
            
            <!-- Edit/Replace (only if user has write permission) -->
            {% if 'write' in user_permissions.documents %}
            <form method="post" enctype="multipart/form-data" style="display:inline;">
                {% csrf_token %}
                <input type="hidden" name="action" value="write">
                <input type="hidden" name="id" value="{{ doc.id }}">
                <input type="file" name="file" accept=".pdf,.doc,.docx,.txt" required>
                <button type="submit">Replace</button>
            </form>
            {% endif %}
        </li>
    {% empty %}
        <li>No documents uploaded.</li>
    {% endfor %}
</ul>
{% endblock %}